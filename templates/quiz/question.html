<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />

  <meta name="_csrf" th:content="${_csrf.token}">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <meta name="_csrf_parameter" th:content="${_csrf.parameterName}">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  
  <title>トイタビ – プレイ中</title>
  <!--全ページ共通のCSS-->
  <link rel="stylesheet" href="../../static/css/common.css" th:href="@{/css/common.css}">
  <!--ローディング画面用CSS-->
  <link rel="stylesheet" href="../../static/css/loading.css" th:href="@{/css/loading.css}">

  <!--LeafletのCDNに 事前接続 して読み込みを高速化-->
  <link rel="preconnect" href="https://unpkg.com" />
  <!--プレイ中（問題画面）専用のCSS-->
  <link rel="stylesheet" href="../../static/css/question.css" th:href="@{/css/question.css}">
  <!-- Leaflet CSS / JS（CDN）, 地図表示用CSS-->
  <link  rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <!--LeafletのJavaScript本体-->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- LeafletLocate CSS / JS（CDN）, 現在地ボタンのCSS-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.85.1/dist/L.Control.Locate.min.css">
  <!--現在地取得用JS-->
  <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.85.1/dist/L.Control.Locate.min.js"></script>

  <!--サーバー通信（fetch / Ajax）用-->
  <script src="../../static/js/serverRequest.js" th:src="@{/js/serverRequest.js}"></script>
  <!--データ暗号化処理-->
  <script src="../../static/js/encrypt.js" th:src="@{/js/encrypt.js}"/></script>
  <!--共通関数まとめ-->
  <script src="../../static/js/common.js" th:src="@{/js/common.js}"/></script>
  <!--問題画面の画面遷移制御-->
  <script src="../../static/js/navigate/questionnavidev.js" th:src="@{/js/navigate/questionnavipro.js}"></script>
</head>

<!--ページ本体開始 背景色をCSS変数 --ink に設定-->
<body style="background-color:var(--ink);">
  <!--画面全体のレイアウト管理用-->
  <div class="screen">
  <!--Thymeleafの値をJS内で使えるようにする-->
  <!--サーバーから渡された response をJS変数に代入-->
  <script th:inline="javascript">
    let response =/*[[${response}]]*/
  </script> 

  <!-- Header -->
  <header class="app-header">
    <!--ロゴとタイトル領域-->
    <div class="header-logo">
      <!--ロゴ画像表示-->
      <img src="../../static/asset/images/logo_white.png" th:src="@{/asset/images/logo.png}" alt="トイタビ ロゴ" />
      <!--プレイ中メッセージ-->
      <p class="lead">トイスポットを探そう！</p>
    </div>
  </header>

  <!-- 中央スクロール領域 -->
  <main class="content" id="scrollArea">
    <!--中央寄せ・余白調整用-->
    <div class = "container">
      <!-- 写真4枚 -->
      <section class="gallery card">
        <!--メイン写真-->
        <div class="main-photo">
          <!--選択された写真を表示（JSで差し替え）-->
          <img id="mainPhoto" src="" alt="spot main">
        </div>

        <!--サムネイル一覧-->
        <div class="thumbs" id="thumbs">
          <!-- バックエンドから持ってくる（今は仮） -->
          <button class="thumb is-active" data-src="" th:data-src="@{\asset\images\default\NoImage.jpg}">
            <img src="..\..\static\asset\images\default\NoImage.jpg" th:src="@{\asset\images\default\NoImage.jpg}" alt="">
          </button>
          <button class="thumb" data-src="" th:data-src="@{\asset\images\default\NoImage.jpg}">
            <img src="..\..\static\asset\images\default\NoImage.jpg" th:src="@{\asset\images\default\NoImage.jpg}" alt="">
          </button>
          <button class="thumb" data-src="" th:data-src="@{\asset\images\default\NoImage.jpg}">
            <img src="..\..\static\asset\images\default\NoImage.jpg" th:src="@{\asset\images\default\NoImage.jpg}" alt="">
          </button>
          <button class="thumb" data-src="" th:data-src="@{\asset\images\default\NoImage.jpg}">
            <img src="..\..\static\asset\images\default\NoImage.jpg" th:src="@{\asset\images\default\NoImage.jpg}" alt="">
          </button>
        </div>
      </section>

      <!-- 現在地マップ -->
      <section class="map-wrap card" style="padding:12px">
        <!--Leafletが地図を描画するDOM-->
        <div id="map"></div>
        <!--注意書き-->
        <div class="map-caption">現在地を表示中（位置情報の許可が必要です）</div>
      </section>

      <!-- 必要なら下に説明や距離表示など -->
      <div style="height:12px">
        <!--スポット説明文（JSで挿入）-->
        <p id="description"></p>
      </div>
      <div style="height:12px">
        <!--残り距離表示（JSで更新）-->
        <p id="distance">あと100m</p>
      </div>
    </div>
  </main>

  <!--footer-->
  <footer class="app-footer">
    <!-- Bottom actions -->
    <div class="bottom-actions">
      <!--メニュー表示ボタン-->
      <button class="action-btn" type="button" onclick= "onclickSetting()">
        <!--text-->
        <div class ="caption">メニュー</div>
        <!--icon-->
        <img class = "icon-img" src = "../../static/asset/images/menulogo.png" th:src="@{/asset/images/menulogo.png}"/>
      </button>

      <!--スポット確定ボタン-->
      <button class="action-btn" type="button" onclick= "onclickPost()" >
        <!--text-->
        <div class="caption">トイスポット確定</div>
        <!--icon-->
        <img class = "icon-img" src = "../../static/asset/images/confirmicon.png" th:src="@{/asset/images/spotpostlogo.png}"/>
      </button>
    </div>
  </footer>
  </div>

  <!-- ローディングオーバーレイ -->
  <div id="loadingOverlay">
    <!--回転アニメーション-->
    <div class="spinner"></div>
  </div>

  <!-- Leaflet JSライブラリ -->
  <script src="../../static/js/quiz/question.js" th:src="@{/js/quiz/question.js}"></script>
</body>
</html>